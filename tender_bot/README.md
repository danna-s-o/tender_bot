# Tender Bot

Telegram-бот для посреднической компании между тендерными специалистами и клиентами.

## Основные функции
- Прием заявок от клиентов
- Назначение исполнителя администратором
- Анонимное общение между клиентом и исполнителем
- Защита от передачи контактов
- Управление статусами сделки и экспорт во внешнюю систему

## Структура проекта
- `bot.py` — основной файл запуска бота
- `db.py` — подключение и работа с базой данных
- `models.py` — SQL-скрипты для создания таблиц
- `handlers/` — обработчики команд и сценариев для разных ролей
- `filters.py` — фильтрация сообщений
- `utils.py` — вспомогательные функции
- `config.py` — настройки и переменные окружения

## Установка и запуск
1. Клонируйте репозиторий и перейдите в папку проекта.
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
3. Настройте параметры подключения к БД и токен бота в `config.py`:
   ```python
   BOT_TOKEN = 'ВАШ_ТОКЕН_ТУТ'
   DB_HOST = 'localhost'
   DB_PORT = 5432
   DB_NAME = 'tenderbot'
   DB_USER = 'postgres'
   DB_PASSWORD = 'password'
   ```
4. Создайте базу данных PostgreSQL и выполните SQL-скрипт из `models.py` (или просто запустите бота — таблицы создадутся автоматически).
5. Запустите бота:
   ```bash
   python bot.py
   ```

## Использование

### Регистрация
- При первом запуске используйте команду `/start` и выберите свою роль (Клиент, Исполнитель, Администратор).

### Для клиента
- Для подачи заявки используйте команду `/new_application` и следуйте инструкциям бота.
- Загрузите необходимые документы и изображения.
- После подтверждения заявка отправится администратору.

### Для администратора
- Используйте команду `/admin_applications` для просмотра новых заявок.
- Просматривайте детали заявки и назначайте исполнителя из списка.

### Для исполнителя
- Используйте команду `/my_deals` для просмотра назначенных сделок.
- Для смены статуса сделки используйте `/status <id_сделки>`, выберите новый статус из предложенных.
- Статус автоматически экспортируется во внешнюю систему (заглушка).

### Общение в чате сделки
- После назначения исполнителя создается групповой чат с ботом, клиентом и исполнителем.
- Бот автоматически удаляет сообщения с контактными данными (телефоны, email, ссылки на мессенджеры).
- Все сообщения логируются для аудита.

## Структура базы данных
- Таблицы: users, applications, files, deals, deal_status_log, messages_log, admin_notifications.
- SQL-скрипт создания таблиц находится в `models.py`.

## Переменные окружения
- BOT_TOKEN — токен Telegram-бота
- DB_HOST, DB_PORT, DB_NAME, DB_USER, DB_PASSWORD — параметры подключения к PostgreSQL

## Экспорт в систему "624"
- После смены статуса сделки данные отправляются во внешний API (заглушка, адрес и токен настраиваются в `handlers/executor.py`).

## Логирование и безопасность
- Все действия и сообщения логируются в базе.
- Сообщения с контактами автоматически удаляются.
- Администратор получает уведомления о подозрительных действиях (реализуется при необходимости).

## Масштабируемость
- Проект легко расширяется: добавляйте новые роли, команды, интеграции.

---

**Вопросы и предложения:**
Пишите вашему разработчику!